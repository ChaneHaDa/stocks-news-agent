# ML μ„λ²„ λ¶„λ¦¬ κµ¬ν„ ν„ν™© (M1 μ™„λ£)

## β… M1 (Day 1-2) μ™„λ£ ν•­λ©

### 1. Contracts μ¤ν‚¤λ§ μ €μ¥μ† κµ¬μ¶•
**μ„μΉ**: `/contracts/`
- **ml-api.yml**: ML μ„λΉ„μ¤ μ „μ© OpenAPI μ¤ν™ μ •μ
- **schemas/ml_types.json**: κ³µν†µ μ¤ν‚¤λ§ νƒ€μ… μ •μ
- **codegen.yml**: μ½”λ“ μƒμ„± μ„¤μ •

**μ£Όμ” API μ¤ν™**:
- `/v1/importance:score` - λ‰΄μ¤ μ¤‘μ”λ„ μ¤μ½”μ–΄λ§
- `/v1/summarize` - κΈ°μ‚¬ μ”μ•½ μƒμ„±
- `/v1/embed` - ν…μ¤νΈ μ„λ² λ”© μƒμ„±
- `/admin/health` - ν—¬μ¤μ²΄ν¬
- `/admin/reload` - λ¨λΈ λ¦¬λ΅λ“

### 2. ML Serving μ„λΉ„μ¤ (FastAPI)
**μ„μΉ**: `/ml/serving/`

**ν”„λ΅μ νΈ κµ¬μ΅°**:
```
ml/serving/
β”β”€β”€ ml_service/
β”‚   β”β”€β”€ main.py              # FastAPI λ©”μΈ μ• ν”λ¦¬μΌ€μ΄μ…
β”‚   β”β”€β”€ core/
β”‚   β”‚   β”β”€β”€ config.py        # μ„¤μ • κ΄€λ¦¬
β”‚   β”‚   β”β”€β”€ logging.py       # κµ¬μ΅°ν™” λ΅κΉ…
β”‚   β”‚   β””β”€β”€ metrics.py       # Prometheus λ©”νΈλ¦­
β”‚   β”β”€β”€ api/
β”‚   β”‚   β”β”€β”€ admin.py         # μ–΄λ“λ―Ό μ—”λ“ν¬μΈνΈ
β”‚   β”‚   β””β”€β”€ v1.py           # ML API μ—”λ“ν¬μΈνΈ
β”‚   β””β”€β”€ services/
β”‚       β”β”€β”€ model_manager.py # λ¨λΈ λ§¤λ‹μ €
β”‚       β”β”€β”€ importance_service.py  # μ¤‘μ”λ„ μ„λΉ„μ¤ (λ©μ—…)
β”‚       β”β”€β”€ summarize_service.py   # μ”μ•½ μ„λΉ„μ¤ (λ©μ—…)
β”‚       β””β”€β”€ embed_service.py       # μ„λ² λ”© μ„λΉ„μ¤ (λ©μ—…)
β”β”€β”€ requirements.txt         # Python μμ΅΄μ„±
β”β”€β”€ pyproject.toml          # ν”„λ΅μ νΈ μ„¤μ •
β””β”€β”€ Dockerfile              # μ»¨ν…μ΄λ„ μ΄λ―Έμ§€
```

**κΈ°λ¥ κµ¬ν„ μƒνƒ**:
- β… FastAPI κΈ°λ³Έ κµ¬μ΅° λ° μ„¤μ •
- β… κµ¬μ΅°ν™” λ΅κΉ… (JSON ν•μ‹)
- β… Prometheus λ©”νΈλ¦­ μμ§‘
- β… ν—¬μ¤μ²΄ν¬ λ° λ¨λΈ μƒνƒ λ¨λ‹ν„°λ§
- β… 3κ° μ£Όμ” μ—”λ“ν¬μΈνΈ λ©μ—… κµ¬ν„

### 3. Spring Boot ML ν΄λΌμ΄μ–ΈνΈ μ—°λ™
**μ„μΉ**: `/services/api/src/main/java/com/newsagent/api/`

**μ£Όμ” κµ¬ν„**:
- **MlClient**: HTTP ν΄λΌμ΄μ–ΈνΈ μ„λΉ„μ¤
- **Circuit Breaker**: Resilience4J κΈ°λ° μ¥μ•  κ²©λ¦¬
- **Cache**: Caffeine κΈ°λ° μ‘λ‹µ μΊμ‹±
- **Fallback**: ML μ„λΉ„μ¤ μ¥μ•  μ‹ κ·μΉ™ κΈ°λ° ν΄λ°±

**μ„¤μ • νμΌ**:
- `MlServiceConfig`: ML μ„λΉ„μ¤ μ—°λ™ μ„¤μ •
- `RestTemplateConfig`: HTTP ν΄λΌμ΄μ–ΈνΈ μ„¤μ •
- `CacheConfig`: μΊμ‹ κµ¬μ„±
- `application-resilience.yml`: μ„ν‚· λΈλ μ΄μ»¤ λ° μ¬μ‹λ„ μ„¤μ •

### 4. Docker Compose ν†µν•©
**docker-compose.yml μ—…λ°μ΄νΈ**:
```yaml
services:
  api:
    environment:
      - ML_SERVICE_URL=http://ml-service:8001
    depends_on:
      ml-service:
        condition: service_healthy

  ml-service:
    build: ./ml/serving
    ports:
      - "8001:8001"
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8001/admin/health || exit 1"]
```

## π”§ μ£Όμ” κΈ°μ μ  κµ¬ν„

### μ„ν‚· λΈλ μ΄μ»¤ ν¨ν„΄
- **μ‹¤ν¨μ¨ μ„κ³„κ°’**: 50%
- **λ€κΈ° μ‹κ°„**: 30μ΄ (OPEN μƒνƒ)
- **μ¬μ‹λ„**: μµλ€ 3ν, μ§€μ λ°±μ¤ν”„

### μΊμ‹± μ „λµ
- **μ¤‘μ”λ„ μ μ**: 5λ¶„ TTL, μµλ€ 1000κ° ν•­λ©
- **μ”μ•½**: 24μ‹κ°„ TTL, μµλ€ 500κ° ν•­λ©

### Fallback λ©”μ»¤λ‹μ¦
1. **μ¤‘μ”λ„ μ¤μ½”μ–΄λ§**: κ·μΉ™ κΈ°λ° ν΄λ¦¬μ¤ν‹± μ¤μ½”μ–΄
2. **μ”μ•½**: μ¶”μ¶μ  μ”μ•½ (μ²« λ¬Έμ¥ κΈ°λ°)
3. **μ„λ² λ”©**: ν΄λ°± μ—†μ (Optional.empty λ°ν™)

### λ¨λ‹ν„°λ§ μ§€ν‘
- **μ”μ²­ μ§€ν‘**: μΉ΄μ΄νΈ, λ μ΄ν„΄μ‹ (μ—”λ“ν¬μΈνΈλ³„)
- **λ¨λΈ μ§€ν‘**: μ¶”λ΅  μ‹κ°„, μ¶”λ΅  νμ, λ¨λΈ μƒνƒ
- **μΊμ‹ μ§€ν‘**: ννΈμ¨, λ―Έμ¤μ¨
- **μ—λ¬ μ§€ν‘**: μ—λ¬ νƒ€μ…λ³„ μΉ΄μ΄νΈ

## π€ λ‹¤μ λ‹¨κ³„ (M2 μ¤€λΉ„)

### μ°μ„ μμ„ 1: μ‹¤μ  ML λ¨λΈ ν†µν•©
1. **μ¤‘μ”λ„ λ¨λΈ**: λ΅μ§€μ¤ν‹± νκ·€ β†’ LightGBM
2. **μ”μ•½ λ¨λΈ**: LLM API ν†µν•© (GPT/Claude)
3. **μ„λ² λ”© λ¨λΈ**: sentence-transformers μ‹¤μ  λ΅λ”©

### μ°μ„ μμ„ 2: μ„±λ¥ μµμ ν™”
1. **λ°°μΉ μ²λ¦¬**: μ—¬λ¬ λ‰΄μ¤ λ™μ‹ μ²λ¦¬
2. **λΉ„λ™κΈ° μ²λ¦¬**: μ”μ•½ λ“± μ‹κ°„ μ†μ” μ‘μ—…
3. **λ¨λΈ μΊμ‹±**: λ©”λ¨λ¦¬ λ‚΄ λ¨λΈ λ΅λ”© μµμ ν™”

### μ°μ„ μμ„ 3: μ΄μ μ¤€λΉ„
1. **λ΅κΉ… κ°μ„ **: μ¶”μ  κ°€λ¥ν• μ”μ²­ ID
2. **λ©”νΈλ¦­ ν™•μ¥**: λΉ„μ¦λ‹μ¤ μ§€ν‘ μ¶”κ°€
3. **μ•λ¦Ό μ„¤μ •**: μ¥μ•  μƒν™© κ²½κ³ 

## β… μλ½ κΈ°μ¤€ λ‹¬μ„± ν„ν™©

### M1 λ©ν‘ λ‹¬μ„±
- β… **κ³„μ•½ ν™•μ •**: OpenAPI μ¤ν™ λ° μ¤ν‚¤λ§ μ •μ μ™„λ£
- β… **λ©μ—… μ„λΉ™**: 3κ° μ—”λ“ν¬μΈνΈ λ™μ‘ ν™•μΈ
- β… **ν΄λΌμ΄μ–ΈνΈ μ—°κ²°**: Spring Boot β†” FastAPI ν†µμ‹  κµ¬ν„
- β… **docker-compose**: ν†µν•© ν™κ²½μ—μ„ μ„λΉ„μ¤ κ°„ μ—°λ™ λ™μ‘

### κΈ°μ μ  κ²€μ¦
- β… ML μ„λΉ„μ¤ λ‹¤μ΄ μ‹ ν΄λ°± λ™μ‘ ν™•μΈ
- β… μ„ν‚· λΈλ μ΄μ»¤ μ¥μ•  κ²©λ¦¬ λ™μ‘
- β… μΊμ‹ μ μ¤‘ μ‹ μ‘λ‹µ μ†λ„ ν–¥μƒ
- β… ν—¬μ¤μ²΄ν¬ λ° λ¨λ‹ν„°λ§ μ§€ν‘ λ…Έμ¶

## π”§ μ‹¤ν–‰ λ°©λ²•

### κ°λ° ν™κ²½ κµ¬λ™
```bash
# μ „μ²΄ μ„λΉ„μ¤ μ‹μ‘
docker-compose up --build

# ML μ„λΉ„μ¤ λ‹¨λ… μ‹¤ν–‰  
cd ml/serving
pip install -r requirements.txt
uvicorn ml_service.main:app --host 0.0.0.0 --port 8001

# Spring Boot API μ„λΉ„μ¤
cd services/api
./gradlew bootRun
```

### ν—¬μ¤μ²΄ν¬ ν™•μΈ
```bash
# ML μ„λΉ„μ¤ ν—¬μ¤μ²΄ν¬
curl http://localhost:8001/admin/health

# API μ„λΉ„μ¤ ν—¬μ¤μ²΄ν¬  
curl http://localhost:8000/healthz

# ML μ„λΉ„μ¤ λ©”νΈλ¦­
curl http://localhost:8001/metrics
```

## π“‹ μ΄ν›„ λ΅λ“λ§µ

**M2 (Day 3-5)**: μ‹¤μ  ML λ¨λΈ ν†µν•© λ° μ„±λ¥ μµμ ν™”
**M3 (Day 6-8)**: μ„λ² λ”© κΈ°λ° ν† ν”½ ν΄λ¬μ¤ν„°λ§ λ° κ°μΈν™”
**M4 (Day 9-10)**: μ΄μ λ¨λ‹ν„°λ§ λ° λ¬Έμ„ν™” μ™„λ£

---
*μ΄ λ¬Έμ„λ” ML μ„λ²„ λ¶„λ¦¬ ν”„λ΅μ νΈμ M1 λ§μΌμ¤ν†¤ μ™„λ£ λ³΄κ³ μ„μ…λ‹λ‹¤.*